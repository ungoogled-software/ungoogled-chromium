From 7134d5fd762237ad2d80093b68ccbd1582476640 Mon Sep 17 00:00:00 2001
From: Joachim Bauch <jojo@struktur.de>
Date: Thu, 25 Jun 2015 15:51:59 +0200
Subject: [PATCH 56/66] browser: disable profile auto-import on first run

--- a/chrome/browser/chrome_browser_main.cc
+++ b/chrome/browser/chrome_browser_main.cc
@@ -1589,30 +1589,6 @@ int ChromeBrowserMainParts::PreMainMessa
   // and preferences have been registered since some of the import code depends
   // on preferences.
   if (first_run::IsChromeFirstRun()) {
-    // `profile` may be nullptr even on first run, for example when the
-    // "BrowserSignin" policy is set to "Force". If so, skip the auto import.
-    if (profile) {
-      first_run::AutoImport(profile, master_prefs_->import_bookmarks_path);
-
-      if (base::FeatureList::IsEnabled(features::kBookmarksImportOnFirstRun) &&
-          !master_prefs_->import_bookmarks_dict.empty()) {
-        first_run::StartBookmarkImportFromDict(
-            profile, std::move(master_prefs_->import_bookmarks_dict));
-      }
-
-#if BUILDFLAG(ENABLE_EXTENSIONS)
-      if (base::FeatureList::IsEnabled(features::kInitialExternalExtensions)) {
-        profile->GetPrefs()->SetString(
-            extensions::pref_names::kInitialInstallProviderName,
-            std::move(master_prefs_->initial_extensions_provider_name));
-        // Store the initial extension IDs into the profile's prefs so that
-        // InitialExternalExtensionLoader can later pick them up.
-        profile->GetPrefs()->SetList(
-            extensions::pref_names::kInitialInstallList,
-            std::move(master_prefs_->initial_extensions));
-      }
-#endif  // BUILDFLAG(ENABLE_EXTENSIONS)
-    }
 
     // Note: This can pop-up the first run consent dialog on Linux & Mac.
     first_run::DoPostImportTasks(master_prefs_->make_chrome_default_for_user);
